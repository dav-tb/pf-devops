{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["env", "postgresql"],
  "properties": {
    "replicaCount": {
      "type": "integer",
      "description": "Number of pod replicas for the deployment.",
      "default": 1
    },
    "image": {
      "type": "object",
      "description": "Container image configuration for the application.",
      "properties": {
        "repository": {
          "type": "string",
          "description": "Image repository."
        },
        "pullPolicy": {
          "type": "string",
          "enum": ["Always", "IfNotPresent", "Never"],
          "description": "Image pull policy."
        },
        "tag": {
          "type": "string",
          "description": "Image tag. Defaults to chart appVersion if empty."
        }
      }
    },
    "imagePullSecrets": {
      "type": "array",
      "description": "Secrets for pulling images from private repositories.",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          }
        }
      }
    },
    "nameOverride": {
      "type": "string",
      "description": "Override the chart name."
    },
    "fullnameOverride": {
      "type": "string",
      "description": "Override the full release name."
    },
    "serviceAccount": {
      "type": "object",
      "description": "Service account configuration.",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Whether to create a service account."
        },
        "automount": {
          "type": "boolean",
          "description": "Automatically mount ServiceAccount API credentials."
        },
        "annotations": {
          "type": "object",
          "description": "Annotations to add to the service account."
        },
        "name": {
          "type": "string",
          "description": "Name of the service account to use."
        }
      }
    },
    "podAnnotations": {
      "type": "object",
      "description": "Annotations to add to pods."
    },
    "podLabels": {
      "type": "object",
      "description": "Labels to add to pods."
    },
    "podSecurityContext": {
      "type": "object",
      "description": "Pod-level security context."
    },
    "securityContext": {
      "type": "object",
      "description": "Container-level security context."
    },
    "service": {
      "type": "object",
      "description": "Service configuration.",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ClusterIP", "NodePort", "LoadBalancer", "ExternalName"],
          "description": "Kubernetes service type."
        },
        "port": {
          "type": "integer",
          "description": "Service port."
        }
      }
    },
    "resources": {
      "type": "object",
      "description": "Resource requests and limits.",
      "properties": {
        "limits": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          }
        },
        "requests": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          }
        }
      }
    },
    "livenessProbe": {
      "type": "object",
      "description": "Liveness probe configuration."
    },
    "readinessProbe": {
      "type": "object",
      "description": "Readiness probe configuration."
    },
    "volumes": {
      "type": "array",
      "description": "Additional volumes for the deployment.",
      "items": {
        "type": "object"
      }
    },
    "volumeMounts": {
      "type": "array",
      "description": "Additional volume mounts for the deployment.",
      "items": {
        "type": "object"
      }
    },
    "autoscaling": {
      "type": "object",
      "description": "Horizontal pod autoscaling configuration.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether autoscaling is enabled."
        }
      }
    },
    "env": {
      "type": "string",
      "description": "Environment name (e.g., 'development', 'production'). Used for node affinity, tolerations, and the ENV environment variable."
    },
    "extraTolerations": {
      "type": "array",
      "description": "Additional tolerations to apply to pods beyond the default environment-based toleration.",
      "items": {
        "type": "object",
        "properties": {
          "effect": {
            "type": "string",
            "enum": ["NoSchedule", "PreferNoSchedule", "NoExecute"]
          },
          "key": {
            "type": "string"
          },
          "operator": {
            "type": "string",
            "enum": ["Exists", "Equal"]
          },
          "tolerationSeconds": {
            "type": "integer"
          },
          "value": {
            "type": "string"
          }
        }
      }
    },
    "affinity": {
      "type": "object",
      "description": "Additional affinity rules."
    },
    "podDisruptionBudget": {
      "type": "object",
      "description": "Pod disruption budget configuration.",
      "properties": {
        "minAvailable": {
          "type": "integer",
          "description": "Minimum number of pods that must be available during disruptions."
        }
      }
    },
    "connectionString": {
      "type": "string",
      "description": "Optional connection string override. If provided, takes priority over auto-generated string from postgresql values."
    },
    "postgresql": {
      "type": "object",
      "required": ["database", "port", "imageRepository", "imageTag", "volumeMountPath", "volumeClaimAccessModes", "volumeClaimStorageResourceRequest", "appUsername", "appPasswordSecretKeyRefKey", "adminUsername", "adminPasswordSecretKeyRefKey", "replUsername", "replPasswordSecretKeyRefKey"],
      "properties": {
        "database": {
          "type": "string",
          "description": "PostgreSQL database name."
        },
        "port": {
          "type": "integer",
          "description": "PostgreSQL port number.",
          "default": 5432
        },
        "imageRepository": {
          "type": "string",
          "description": "PostgreSQL container image repository."
        },
        "imageTag": {
          "type": "string",
          "description": "PostgreSQL container image tag."
        },
        "volumeMountPath": {
          "type": "string",
          "description": "Mount path for PostgreSQL data volume."
        },
        "volumeClaimAccessModes": {
          "type": "array",
          "description": "Access modes for the PostgreSQL PersistentVolumeClaim.",
          "items": {
            "type": "string",
            "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"]
          }
        },
        "volumeClaimStorageResourceRequest": {
          "type": "string",
          "description": "Storage size request for the PostgreSQL PersistentVolumeClaim (e.g., '1Gi', '10Gi')."
        },
        "appUsername": {
          "type": "string",
          "description": "Application user - created dynamically with full privileges on the database."
        },
        "appPasswordSecretKeyRefName": {
          "type": "string",
          "description": "Name of the Kubernetes secret containing the application user password. If empty, a random password is generated."
        },
        "appPasswordSecretKeyRefKey": {
          "type": "string",
          "description": "Key within the secret that contains the application user password."
        },
        "adminUsername": {
          "type": "string",
          "description": "Admin user - used for POSTGRESQL_USERNAME/PASSWORD, creates the app user."
        },
        "adminPasswordSecretKeyRefName": {
          "type": "string",
          "description": "Name of the Kubernetes secret containing the admin password. If empty, a random password is generated."
        },
        "adminPasswordSecretKeyRefKey": {
          "type": "string",
          "description": "Key within the secret that contains the admin password."
        },
        "replUsername": {
          "type": "string",
          "description": "PostgreSQL replication username."
        },
        "replPasswordSecretKeyRefName": {
          "type": "string",
          "description": "Name of the Kubernetes secret containing the replication password. If empty, a random password is generated."
        },
        "replPasswordSecretKeyRefKey": {
          "type": "string",
          "description": "Key within the secret that contains the replication password."
        }
      }
    }
  }
}
